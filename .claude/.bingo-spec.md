# Buzzword Bingo - Detailed Specification

## Game Mechanics

### Card Generation
- Each player gets a unique 5x5 bingo card
- 25 squares total: 24 words + 1 FREE space in center (position [2,2])
- Words randomly selected from a master word list
- No duplicate words on the same card
- Cards should be different between players (statistical uniqueness)

### Word List
Admin provides a list of buzzwords/phrases for the meeting. Examples:
- "synergy"
- "circle back"
- "low-hanging fruit"
- "move the needle"
- "paradigm shift"
- "think outside the box"
- "take this offline"
- "ping me"
- "deep dive"
- "touch base"
- etc.

**Requirements:**
- Minimum 24 words needed (to fill a card)
- Recommended 40-60 words for good variety
- Case-insensitive matching (admin says "SYNERGY" = card shows "synergy")

### Marking Squares
- Players click/tap squares when they hear the word
- Words can be marked in any order
- Once marked, square stays marked (no unmarking)
- Center "FREE" square is pre-marked
- Players can mark squares even if admin hasn't "called" the word (self-paced)

### Win Conditions
A player wins by completing any of these patterns:

**5 ways to win:**
1. **Horizontal line**: Any complete row (5 in a row)
2. **Vertical line**: Any complete column (5 in a column)  
3. **Diagonal (top-left to bottom-right)**: [0,0] â†’ [1,1] â†’ [2,2] â†’ [3,3] â†’ [4,4]
4. **Diagonal (top-right to bottom-left)**: [0,4] â†’ [1,3] â†’ [2,2] â†’ [3,1] â†’ [4,0]
5. **Four corners + center**: [0,0], [0,4], [4,0], [4,4], [2,2]

**Win rules:**
- **First player to complete ANY pattern wins and gets 100 points**
- **All players are notified who won and what pattern they completed**
- **Game round ends immediately after first winner**
- Admin can start a new round with the same word list

### Multi-Round Play
- Admin can start multiple rounds in the same session
- Each new round:
  - All players get NEW bingo cards with different word arrangements
  - All cards are cleared (unmarked except FREE space)
  - Same word list is used
  - Scores accumulate (Round 1 winner: 100pts, Round 2 winner: 100pts, total: 200pts)
- Players stay in the session across rounds (no re-joining needed)

### Scoring
- **Winner of each round**: 100 points (added to their total)
- **Everyone else**: 0 points for that round
- **Total score**: Sum of all round wins
- **Leaderboard**: Shows cumulative scores across all rounds

### Game Flow

**Single Round:**
1. Admin creates session and uploads word list
2. Admin starts Round 1
3. Each player receives their unique card
4. Presentation begins
5. Players mark squares as they hear words
6. First player completes a pattern:
   - System auto-detects the win
   - **ALL players notified**: "Alice won with horizontal row 3!"
   - Winner gets 100 points
   - Round ends
   - Leaderboard updates

**Multiple Rounds:**
7. Admin clicks "Start New Round"
8. All players get fresh cards (different word arrangements)
9. Round 2 begins
10. Play continues as before
11. Winner of Round 2 gets 100 points (could be same or different player)
12. Process repeats for as many rounds as admin wants

**Example Multi-Round Scoring:**
```
After Round 1:
- Alice: 100 pts (won Round 1)
- Bob: 0 pts
- Carol: 0 pts

After Round 2:
- Alice: 100 pts (no change)
- Bob: 100 pts (won Round 2)
- Carol: 0 pts

After Round 3:
- Alice: 200 pts (won Round 3!)
- Bob: 100 pts
- Carol: 0 pts
```

## Notification Events

When game events happen, the system broadcasts to all players:

### Game Started Event
```typescript
{
  type: 'game_started',
  roundNumber: 1,
  playerCard: BingoCard  // Each player gets their own card
}
```

### Player Won Event
```typescript
{
  type: 'player_won',
  winnerId: string,
  winnerName: string,
  pattern: WinPattern,
  roundNumber: number,
  timestamp: Date
}
```
**Shown to players as:** "ðŸŽ‰ Alice won with a diagonal! Round 1 complete."

### New Round Started Event
```typescript
{
  type: 'new_round_started',
  roundNumber: number,
  playerCard: BingoCard  // Each player gets a NEW card
}
```

## Technical Requirements

### BingoCard Class
```typescript
class BingoCard {
  // 5x5 grid of words (center is "FREE")
  private grid: string[][];
  
  // Track which squares are marked (5x5 boolean grid)
  private marked: boolean[][];
  
  // Unique card ID
  readonly id: string;
  
  // Player who owns this card
  readonly playerId: string;
  
  // Static method to generate a card
  static generate(playerId: string, wordList: string[]): BingoCard;
  
  // Mark a square by word (returns true if successful)
  markWord(word: string): boolean;
  
  // Mark a square by position (returns true if successful)
  markPosition(row: number, col: number): boolean;
  
  // Check if card has any winning pattern
  hasWon(): boolean;
  
  // Get the winning pattern (if any)
  getWinningPattern(): WinPattern | null;
  
  // Get the grid (for display)
  getGrid(): string[][];
  
  // Get marked status (for display)
  getMarked(): boolean[][];
}
```

### WinPattern Type
```typescript
type WinPattern = 
  | { type: 'horizontal', row: number }
  | { type: 'vertical', col: number }
  | { type: 'diagonal', direction: 'tl-br' | 'tr-bl' }
  | { type: 'corners' };
```

### BingoGame Class
```typescript
class BingoGame {
  readonly sessionId: string;
  readonly wordList: string[];
  
  // Current round number
  private currentRound: number;
  
  // Map of playerId -> BingoCard (for current round)
  private cards: Map<string, BingoCard>;
  
  // Game state
  private status: 'waiting' | 'active' | 'finished';
  
  // Winner of current round (null if no winner yet)
  private currentWinner: Winner | null;
  
  // History of all round winners
  private roundWinners: Winner[];
  
  // Create game with word list
  constructor(sessionId: string, wordList: string[]);
  
  // Generate card for a player (for current round)
  generateCardForPlayer(playerId: string): BingoCard;
  
  // Mark word for a player (returns result including if they won)
  markWord(playerId: string, word: string): MarkResult;
  
  // Get game status
  getStatus(): 'waiting' | 'active' | 'finished';
  
  // Get current round number
  getCurrentRound(): number;
  
  // Get winner of current round (null if round not finished)
  getCurrentWinner(): Winner | null;
  
  // Get all round winners
  getRoundWinners(): Winner[];
  
  // Start the first round
  start(): void;
  
  // Start a new round (regenerates all cards)
  startNewRound(): void;
  
  // Get card for specific player
  getCardForPlayer(playerId: string): BingoCard | null;
}

interface MarkResult {
  success: boolean;        // Was the mark successful?
  bingo: boolean;          // Did this mark result in a win?
  pattern?: WinPattern;    // What pattern won (if bingo)
  roundOver: boolean;      // Is the current round now over?
  winnerId?: string;       // Who won (for broadcasting to all players)
  winnerName?: string;     // Winner's screen name (for display)
}

interface Winner {
  playerId: string;
  playerName: string;
  pattern: WinPattern;
  roundNumber: number;
  timestamp: Date;
  points: 100;  // Always 100
}
```

## Test Cases to Cover

### BingoCard Generation
- [ ] Generate card with 24 unique words + FREE center
- [ ] FREE space is always at position [2,2]
- [ ] FREE space is pre-marked
- [ ] All words come from provided word list
- [ ] No duplicate words on same card
- [ ] Reject word list with < 24 words
- [ ] Handle word list with exactly 24 words
- [ ] Generate different cards for different players (randomization)
- [ ] Card ID is unique

### Marking Squares
- [ ] Mark word that exists on card
- [ ] Reject marking word not on card
- [ ] Mark square by position [row, col]
- [ ] Reject marking out-of-bounds position
- [ ] Cannot unmark a marked square
- [ ] Marking same square twice is idempotent
- [ ] Case-insensitive word matching
- [ ] Trim whitespace from words

### Win Detection - Horizontal
- [ ] Detect win: complete row 0
- [ ] Detect win: complete row 1
- [ ] Detect win: complete row 2 (includes FREE)
- [ ] Detect win: complete row 3
- [ ] Detect win: complete row 4
- [ ] No win with 4/5 marked in row

### Win Detection - Vertical
- [ ] Detect win: complete column 0
- [ ] Detect win: complete column 1
- [ ] Detect win: complete column 2 (includes FREE)
- [ ] Detect win: complete column 3
- [ ] Detect win: complete column 4
- [ ] No win with 4/5 marked in column

### Win Detection - Diagonals
- [ ] Detect win: top-left to bottom-right diagonal
- [ ] Detect win: top-right to bottom-left diagonal
- [ ] No win with 4/5 marked in diagonal

### Win Detection - Four Corners
- [ ] Detect win: all 4 corners + center marked
- [ ] No win with 3/4 corners + center

### Win Detection - Multiple Patterns
- [ ] Return first completed pattern
- [ ] If multiple patterns complete with same mark, return any one

### BingoGame Management - Single Round
- [ ] Create game with valid word list
- [ ] Reject word list with < 24 words
- [ ] Generate unique cards for multiple players
- [ ] Game starts in 'waiting' status
- [ ] Current round is 0 before game starts
- [ ] Can start game (moves to 'active', round becomes 1)
- [ ] Cannot mark words before game started
- [ ] First player to complete pattern wins
- [ ] Winner gets 100 points
- [ ] MarkResult includes winner ID and name for broadcasting
- [ ] Game status changes to 'finished' after first win
- [ ] Cannot mark words after round finished
- [ ] Second player to complete pattern does not win (round already over)

### BingoGame Management - Multiple Rounds
- [ ] Start new round after round 1 finishes
- [ ] Round number increments (1 â†’ 2)
- [ ] All players get NEW cards with different arrangements
- [ ] New cards use same word list
- [ ] Old cards are discarded
- [ ] Game status resets to 'active'
- [ ] Previous winner is recorded in history
- [ ] Can win multiple rounds (points accumulate)
- [ ] Different players can win different rounds
- [ ] Cannot start new round while current round is active
- [ ] Round winners history tracks all rounds

### Multi-Round Scoring
- [ ] Player wins Round 1: gets 100 points
- [ ] Player wins Round 2: gets another 100 points (total 200)
- [ ] Different player wins Round 2: both have 100 points
- [ ] Track total points across all rounds

### Edge Cases
- [ ] Word list with duplicate words (should deduplicate)
- [ ] Very long word list (100+ words)
- [ ] Word list with empty strings (should filter)
- [ ] Card generation with exactly 24 words
- [ ] Player completes multiple patterns in same mark
- [ ] Two players try to mark winning square simultaneously (first wins)
- [ ] Start new round immediately (no delay between rounds)
- [ ] Player joins mid-game (gets card for current round only)

## Example Test Data

### Sample Word List (30 words)
```typescript
const sampleBuzzwords = [
  "synergy", "circle back", "low-hanging fruit", "move the needle",
  "paradigm shift", "think outside the box", "take this offline",
  "ping me", "deep dive", "touch base", "bandwidth", "leverage",
  "stakeholder", "alignment", "action items", "best practices",
  "core competency", "drill down", "end of day", "game changer",
  "ideate", "key takeaway", "level set", "net-net", "on my radar",
  "quick win", "reach out", "run it up the flagpole", "streamline",
  "value-add"
];
```

### Example Multi-Round Flow

**Round 1:**
```
Alice's card row 2: ["bandwidth", "leverage", "FREE", "stakeholder", "alignment"]
Bob's card row 2: ["synergy", "ping me", "FREE", "ideate", "net-net"]

Alice marks all of row 2 first
â†’ Alice wins Round 1
â†’ All players see: "ðŸŽ‰ Alice won with horizontal row 2!"
â†’ Scores: Alice: 100, Bob: 0
```

**Round 2 Starts:**
```
Alice gets NEW card row 2: ["deep dive", "action items", "FREE", "quick win", "leverage"]
Bob gets NEW card row 2: ["alignment", "core competency", "FREE", "touch base", "paradigm shift"]

Bob completes diagonal first
â†’ Bob wins Round 2
â†’ All players see: "ðŸŽ‰ Bob won with diagonal!"
â†’ Scores: Alice: 100, Bob: 100
```

**Round 3 Starts:**
```
Cards regenerated again...
Alice wins Round 3
â†’ Scores: Alice: 200, Bob: 100
â†’ Alice is the overall leader!
```

## Implementation Order

1. **BingoCard class** (simplest, most foundational)
   - Generate grid from word list
   - Mark squares
   - Win detection (all 5 patterns)

2. **BingoGame class** (orchestrates game with multi-round support)
   - Create game with word list
   - Generate cards for players
   - Track game status and round number
   - Declare winner on first bingo (with winner info for broadcast)
   - Start new rounds (regenerate all cards)
   - Track round history and cumulative scores

3. **Integration with Session** (connects to larger system)
   - Add BingoGame to Session
   - Update player scores when someone wins
   - Broadcast winner notification to all players
   - Handle new round card distribution

## Success Criteria
âœ… All tests pass
âœ… Can generate unique cards for 50+ players
âœ… Win detection works for all 5 patterns
âœ… Round ends immediately on first win
âœ… Winner info available for broadcasting to all players
âœ… Can start multiple rounds with new cards each time
âœ… Scores accumulate across rounds
âœ… Cannot play after round ends (until new round starts)
âœ… Round history tracked correctly
âœ… Edge cases handled gracefully
